<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banco de Perfiles - UNAL Sede de La Paz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --unal-green: #4CAF50;
      --unal-green-dark: #388E3C;
      --unal-green-light: #C8E6C9;
      --unal-green-bg: #f0f9f0;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #64748b;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg-primary: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --radius: 12px;
      --radius-sm: 8px;
      --radius-lg: 16px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* ========== HEADER ========== */
    .header {
      background: linear-gradient(135deg, var(--unal-green) 0%, var(--unal-green-dark) 100%);
      color: white;
      padding: 2.5rem 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      box-shadow: var(--shadow-lg);
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      line-height: 1.3;
    }

    .header p {
      opacity: 0.95;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    /* ========== INFO BOX ========== */
    .info-box {
      background: var(--unal-green-bg);
      border-left: 4px solid var(--unal-green);
      padding: 1.25rem;
      border-radius: 0 var(--radius) var(--radius) 0;
      margin-bottom: 2rem;
    }

    .info-box h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--unal-green-dark);
      margin-bottom: 0.75rem;
    }

    .info-box p {
      font-size: 0.9rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .info-box ul {
      margin-left: 1.5rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
      list-style: none;
    }

    .info-box li {
      margin-bottom: 0.25rem;
      cursor: pointer;
      transition: color 0.2s, transform 0.2s;
    }

    .info-box li:hover {
      color: var(--unal-green-dark);
      transform: translateX(4px);
    }

    /* ========== FORM CARD ========== */
    .form-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .form-group {
      margin-bottom: 1.25rem;
      position: relative;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.4rem;
    }

    .field-wrapper {
      position: relative;
    }

    .field-icon {
      position: absolute;
      right: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--success);
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .field-icon.visible {
      opacity: 1;
    }

    .field-icon .material-icons {
      font-size: 1.25rem;
    }

    .char-counter {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: right;
      margin-top: 0.25rem;
    }

    .char-counter.warning {
      color: var(--warning);
    }

    .required {
      color: var(--danger);
      margin-left: 0.2rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--bg-card);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--unal-green);
      box-shadow: 0 0 0 3px var(--unal-green-light);
    }

    .form-input.valid,
    .form-textarea.valid,
    .form-select.valid {
      border-color: var(--success);
      padding-right: 2.5rem;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-error {
      color: var(--danger);
      font-size: 0.8rem;
      margin-top: 0.25rem;
      display: none;
    }

    .form-error.visible {
      display: block;
    }

    .form-input.error,
    .form-textarea.error,
    .form-select.error {
      border-color: var(--danger);
    }

    /* ========== CHECKBOX GROUP ========== */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-primary);
      cursor: pointer;
    }

    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--unal-green);
      cursor: pointer;
    }

    /* ========== RADIO GROUP ========== */
    .radio-group {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .radio-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-primary);
      cursor: pointer;
    }

    .radio-label input[type="radio"] {
      width: 18px;
      height: 18px;
      accent-color: var(--unal-green);
      cursor: pointer;
    }

    /* ========== PERFIL CARD / ACCORDION ========== */
    .perfil-card {
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s;
    }

    .perfil-card:hover {
      box-shadow: var(--shadow-md);
    }

    .perfil-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.25rem 1.5rem;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
    }

    .perfil-header:hover {
      background: var(--bg-primary);
    }

    .perfil-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex: 1;
    }

    .perfil-header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .perfil-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: var(--unal-green-light);
      border-radius: 50%;
      flex-shrink: 0;
    }

    .perfil-toggle .material-icons {
      font-size: 1.5rem;
      color: var(--unal-green-dark);
      transition: transform 0.3s;
    }

    .perfil-card.collapsed .perfil-toggle .material-icons {
      transform: rotate(-90deg);
    }

    .perfil-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }

    .perfil-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .perfil-badge.incomplete {
      background: #fef3c7;
      color: #92400e;
    }

    .perfil-badge.complete {
      background: #d1fae5;
      color: #065f46;
    }

    .perfil-badge .material-icons {
      font-size: 0.9rem;
    }

    .perfil-progress {
      margin-top: 1rem;
      padding: 0 1.5rem 1rem;
    }

    .progress-bar-container {
      height: 6px;
      background: var(--border);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--unal-green) 0%, var(--unal-green-dark) 100%);
      border-radius: 3px;
      transition: width 0.3s ease;
    }

    .progress-text {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: right;
    }

    .perfil-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .perfil-card.expanded .perfil-body {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }

    .perfil-body-inner {
      padding: 0 1.5rem 1.5rem;
    }

    .btn-remove-perfil {
      background: var(--danger);
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .btn-remove-perfil:hover {
      background: #dc2626;
    }

    .btn-remove-perfil .material-icons {
      font-size: 1rem;
    }

    /* ========== BUTTONS ========== */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      touch-action: manipulation;
    }

    .btn-primary {
      background: var(--unal-green);
      color: white;
    }

    .btn-primary:hover {
      background: var(--unal-green-dark);
    }

    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-secondary);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--unal-green);
      color: var(--unal-green);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn .material-icons {
      font-size: 1.2rem;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid var(--border);
    }

    .btn-add-perfil {
      width: 100%;
      justify-content: center;
      margin-top: 1rem;
    }

    /* ========== SUCCESS MESSAGE ========== */
    .success-message {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      padding: 3rem 2rem;
      text-align: center;
      display: none;
    }

    .success-message.visible {
      display: block;
    }

    .success-message .material-icons {
      font-size: 4rem;
      color: var(--success);
      margin-bottom: 1rem;
    }

    .success-message h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .success-message p {
      font-size: 1rem;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    /* ========== ERROR ALERT ========== */
    .error-alert {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: none;
    }

    .error-alert.visible {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .error-alert .material-icons {
      color: var(--danger);
      flex-shrink: 0;
    }

    .error-alert p {
      font-size: 0.875rem;
      color: #dc2626;
      margin: 0;
    }

    /* ========== LOADING OVERLAY ========== */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-overlay.visible {
      display: flex;
    }

    .loading-content {
      background: var(--bg-card);
      padding: 2rem;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: var(--shadow-lg);
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border);
      border-top-color: var(--unal-green);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-content p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }

      .header {
        padding: 2rem 1.5rem;
      }

      .header h1 {
        font-size: 1.4rem;
      }

      .form-card {
        padding: 1.5rem;
      }

      .perfil-header {
        padding: 1rem 1.25rem;
      }

      .perfil-body-inner {
        padding: 0 1.25rem 1.25rem;
      }

      .form-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .radio-group {
        flex-direction: column;
        gap: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 1.25rem;
      }

      .form-card {
        padding: 1.25rem;
      }

      .perfil-header {
        padding: 1rem;
        flex-wrap: wrap;
      }

      .perfil-header-left {
        flex: 1;
        min-width: 0;
      }

      .perfil-title {
        font-size: 0.9rem;
      }

      .btn-remove-perfil {
        padding: 0.35rem 0.7rem;
        font-size: 0.75rem;
      }

      .btn-remove-perfil .material-icons {
        font-size: 0.9rem;
      }

      .perfil-header-right {
        gap: 0.5rem;
      }

      .perfil-header-right .btn span:not(.material-icons) {
        display: none;
      }

      .perfil-header-right .btn {
        padding: 0.4rem;
        min-width: 32px;
        height: 32px;
        justify-content: center;
      }
    }

    @media (max-width: 380px) {
      .perfil-header-right {
        gap: 0.35rem;
      }
    }

    /* ========== MODAL ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      padding: 1rem;
    }

    .modal-overlay.visible {
      display: flex;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      max-width: 800px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-header {
      position: sticky;
      top: 0;
      background: white;
      border-bottom: 2px solid var(--border);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      z-index: 10;
    }

    .modal-header-text {
      flex: 1;
    }

    .modal-logo {
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
      line-height: 1.2;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .btn-close-modal {
      background: var(--bg-primary);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .btn-close-modal:hover {
      background: var(--border);
    }

    .btn-close-modal .material-icons {
      font-size: 1.5rem;
      color: var(--text-secondary);
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-body p {
      font-size: 0.95rem;
      line-height: 1.8;
      text-align: justify;
      color: var(--text-primary);
      margin-bottom: 1.25rem;
    }

    .modal-body p:last-child {
      margin-bottom: 0;
    }

    @media (max-width: 768px) {
      .modal-content {
        max-height: 95vh;
      }

      .modal-header {
        padding: 1.25rem 1.5rem;
      }

      .modal-title {
        font-size: 1.25rem;
      }

      .modal-body {
        padding: 1.5rem;
      }

      .modal-body p {
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      .modal-header {
        flex-direction: column;
        align-items: stretch;
      }

      .modal-logo {
        text-align: left;
        order: -1;
        margin-bottom: 0.5rem;
      }

      .btn-close-modal {
        position: absolute;
        top: 1rem;
        right: 1rem;
      }
    }

    /* ========== CONFIRM MODAL ========== */
    .confirm-overlay {
      position: fixed;
      inset: 0;
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      padding: 1rem;
    }

    .confirm-overlay.visible {
      display: flex;
    }

    .confirm-content {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      max-width: 400px;
      width: 100%;
      padding: 2rem;
      text-align: center;
    }

    .confirm-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 1.5rem;
      background: #fef2f2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .confirm-icon .material-icons {
      font-size: 2rem;
      color: var(--danger);
    }

    .confirm-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .confirm-message {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .confirm-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
    }

    .btn-confirm {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-confirm-primary {
      background: var(--danger);
      color: white;
    }

    .btn-confirm-primary:hover {
      background: #dc2626;
    }

    .btn-confirm-secondary {
      background: var(--bg-primary);
      color: var(--text-secondary);
      border: 2px solid var(--border);
    }

    .btn-confirm-secondary:hover {
      border-color: var(--text-secondary);
      color: var(--text-primary);
    }

    @media (max-width: 480px) {
      .confirm-content {
        padding: 1.5rem;
      }

      .confirm-actions {
        flex-direction: column-reverse;
      }

      .btn-confirm {
        width: 100%;
      }
    }

    /* ========== PREVIEW MODAL ========== */
    .preview-modal-content {
      max-width: 900px;
    }

    .preview-section {
      margin-bottom: 2rem;
    }

    .preview-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .preview-field {
      margin-bottom: 1rem;
    }

    .preview-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .preview-value {
      font-size: 0.9rem;
      color: var(--text-primary);
      padding: 0.5rem;
      background: var(--bg-primary);
      border-radius: var(--radius-sm);
    }

    .preview-perfil-card {
      background: var(--bg-primary);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .preview-perfil-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--unal-green-light);
    }

    .preview-perfil-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--unal-green-dark);
    }

    .preview-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid var(--border);
    }

    @media (max-width: 768px) {
      .preview-actions {
        flex-direction: column;
      }

      .preview-actions .btn {
        width: 100%;
      }
    }

    /* ========== TOAST NOTIFICATIONS ========== */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 4000;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      max-width: 400px;
      pointer-events: none;
    }

    .toast {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      padding: 1rem 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      min-width: 300px;
      transform: translateX(450px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: auto;
      border-left: 4px solid;
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast.success {
      border-left-color: var(--success);
    }

    .toast.success .toast-icon {
      color: var(--success);
    }

    .toast.error {
      border-left-color: var(--danger);
    }

    .toast.error .toast-icon {
      color: var(--danger);
    }

    .toast.warning {
      border-left-color: var(--warning);
    }

    .toast.warning .toast-icon {
      color: var(--warning);
    }

    .toast.info {
      border-left-color: var(--primary);
    }

    .toast.info .toast-icon {
      color: var(--primary);
    }

    .toast-icon {
      flex-shrink: 0;
    }

    .toast-icon .material-icons {
      font-size: 1.5rem;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .toast-message {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s;
      flex-shrink: 0;
    }

    .toast-close:hover {
      color: var(--text-primary);
    }

    .toast-close .material-icons {
      font-size: 1.25rem;
    }

    @media (max-width: 768px) {
      .toast-container {
        right: 10px;
        left: 10px;
        max-width: none;
      }

      .toast {
        min-width: 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <h1>Convocatoria Interna - Banco de Perfiles de Pr√°cticas y Pasant√≠as</h1>
    <p>Universidad Nacional de Colombia ‚Äì Sede de La Paz - 2026-1</p>
  </div>

  <!-- INFO BOX -->
  <div class="info-box">
    <h3>Convocatoria a Dependencias de la Sede de La Paz</h3>
    <p>La Universidad Nacional de Colombia ‚Äì Sede de La Paz, a trav√©s de su Escuela de Pregrados, se encuentra estructurando un banco de perfiles para fortalecer la articulaci√≥n entre los programas acad√©micos y las dependencias de la Sede.</p>
    <p><strong>El prop√≥sito es identificar oportunidades para nuestros estudiantes</strong>, en funci√≥n de las necesidades de las dependencias y/o proyectos internos de la Universidad.</p>
    <p>Agradecemos a las dependencias de la Sede diligenciar este formulario con la informaci√≥n de los perfiles disponibles para acoger estudiantes en la modalidad de pr√°ctica y/o pasant√≠a, de acuerdo con las siguientes √°reas de formaci√≥n:</p>
    <ul>
      <li data-programa="biologia">üîπ L001 - Biolog√≠a</li>
      <li data-programa="estadistica">üîπ L002 - Estad√≠stica</li>
      <li data-programa="geografia">üîπ L003 - Geograf√≠a</li>
      <li data-programa="gestion-cultural">üîπ L004 - Gesti√≥n Cultural y Comunicativa</li>
      <li data-programa="ing-biologica">üîπ L005 - Ingenier√≠a Biol√≥gica</li>
      <li data-programa="ing-mecatronica">üîπ L006 - Ingenier√≠a Mecatr√≥nica</li>
    </ul>
  </div>

  <!-- MODAL PERFIL EGRESADO -->
  <div class="modal-overlay" id="modalPerfil">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-header-text">
          <div class="modal-logo">
            Direcci√≥n Acad√©mica<br>
            Vicerrector√≠a de Sede<br>
            Sede de La Paz
          </div>
          <h2 class="modal-title" id="modalTitle">Perfil del egresado</h2>
        </div>
        <button type="button" class="btn-close-modal" id="btnCloseModal">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Content will be injected here -->
      </div>
    </div>
  </div>

  <!-- PREVIEW MODAL -->
  <div class="modal-overlay" id="previewModal">
    <div class="modal-content preview-modal-content">
      <div class="modal-header">
        <div class="modal-header-text">
          <h2 class="modal-title">Vista previa del formulario</h2>
        </div>
        <button type="button" class="btn-close-modal" id="btnClosePreview">
          <span class="material-icons">close</span>
        </button>
      </div>
      <div class="modal-body" id="previewBody">
        <!-- Content will be injected here -->
      </div>
      <div class="preview-actions">
        <button type="button" class="btn btn-secondary" id="btnEditFromPreview">
          <span class="material-icons">edit</span>
          Editar
        </button>
        <button type="button" class="btn btn-primary" id="btnSubmitFromPreview">
          <span class="material-icons">send</span>
          Enviar formulario
        </button>
      </div>
    </div>
  </div>

  <!-- CONFIRM MODAL (Generic) -->
  <div class="confirm-overlay" id="confirmModal">
    <div class="confirm-content">
      <div class="confirm-icon" id="confirmIcon">
        <span class="material-icons">warning</span>
      </div>
      <h3 class="confirm-title" id="confirmTitle">¬øEliminar este perfil?</h3>
      <p class="confirm-message" id="confirmMessage">¬øEst√°s seguro de que deseas eliminar este perfil? Esta acci√≥n no se puede deshacer.</p>
      <div class="confirm-actions">
        <button type="button" class="btn-confirm btn-confirm-secondary" id="btnCancelConfirm">
          Cancelar
        </button>
        <button type="button" class="btn-confirm btn-confirm-primary" id="btnAcceptConfirm">
          Aceptar
        </button>
      </div>
    </div>
  </div>

  <!-- ERROR ALERT -->
  <div class="error-alert" id="errorAlert">
    <span class="material-icons">error</span>
    <p id="errorMessage"></p>
  </div>

  <!-- MAIN FORM -->
  <div id="mainForm">
    <form id="bancoPerfilesForm">
      
      <!-- DATOS DE LA DEPENDENCIA -->
      <div class="form-card">
        <div class="form-section">
          <div class="section-title">Datos de la Direcci√≥n/Dependencia/Proyecto</div>
          
          <div class="form-group">
            <label class="form-label" for="nombreDependencia">
              Nombre de la Direcci√≥n/Dependencia/Proyecto <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="nombreDependencia" required>
            <div class="form-error" id="error-nombreDependencia">Este campo es obligatorio.</div>
          </div>

          <div class="form-group">
            <label class="form-label" for="correoContacto">
              Correo electr√≥nico <span class="required">*</span>
            </label>
            <input type="email" class="form-input" id="correoContacto" required>
            <div class="form-error" id="error-correoContacto">Ingresa un correo v√°lido.</div>
          </div>

          <div class="form-group">
            <label class="form-label" for="responsable">
              Responsable <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="responsable" required>
            <div class="form-error" id="error-responsable">Este campo es obligatorio.</div>
          </div>
        </div>
      </div>

      <!-- PERFILES CONTAINER -->
      <div id="perfilesContainer"></div>

      <!-- ADD PERFIL BUTTON -->
      <button type="button" class="btn btn-secondary btn-add-perfil" id="btnAddPerfil">
        <span class="material-icons">add_circle</span>
        Agregar otro perfil
      </button>

      <!-- FORM ACTIONS -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnReset">
          <span class="material-icons">restart_alt</span>
          Limpiar formulario
        </button>
        <button type="button" class="btn btn-secondary" id="btnPreview">
          <span class="material-icons">visibility</span>
          Vista previa
        </button>
        <button type="submit" class="btn btn-primary" id="btnSubmit">
          <span class="material-icons">send</span>
          Enviar formulario
        </button>
      </div>

    </form>
  </div>

  <!-- SUCCESS MESSAGE -->
  <div class="success-message" id="successMessage">
    <span class="material-icons">check_circle</span>
    <h2>¬°Formulario enviado exitosamente!</h2>
    <p>Gracias por tu colaboraci√≥n. Hemos recibido la informaci√≥n de los perfiles y ser√° procesada por nuestro equipo.</p>
  </div>

</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Enviando formulario...</p>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<script>
// ============================================================
// GLOBAL STATE
// ============================================================
let perfilCount = 0;
const PROGRAMAS = [
  'L001 - Biolog√≠a',
  'L002 - Estad√≠stica',
  'L003 - Geograf√≠a',
  'L004 - Gesti√≥n Cultural y Comunicativa',
  'L005 - Ingenier√≠a Biol√≥gica',
  'L006 - Ingenier√≠a Mecatr√≥nica'
];

// ============================================================
// PERFILES DE EGRESADOS DATA
// ============================================================
const PERFILES_EGRESADOS = {
  'biologia': {
    title: 'Perfil del egresado - Biolog√≠a',
    content: [
      'Los bi√≥logos egresados de la UNAL, sede De La Paz son profesionales con conocimientos y habilidades necesarias para:',
      '- Describir los procesos, mecanismos, componentes moleculares y celulares que gobiernan el funcionamiento de la c√©lula para regularlos o modificarlos con fines de investigaci√≥n b√°sica y aplicada.',
      '- Conocer la organizaci√≥n jer√°rquica de la biodiversidad, sus interacciones y problem√°ticas, lo cual permite gestionar los retos de conservaci√≥n de la naturaleza considerando los contextos sociales, pol√≠ticos, econ√≥micos y culturales.',
      '- Comprender los procesos de cambio asociados con la evoluci√≥n de la vida y los mecanismos de transmisi√≥n gen√©tica para enfrentar los desaf√≠os y promover el avance de las ciencias biol√≥gicas.',
      '- Formular e implementar proyectos de investigaci√≥n y plantear an√°lisis que permitan contribuir a la toma de decisiones.',
      '-Desempe√±arse en agencias o entidades gubernamentales, privadas, y/o organizaciones ambientales sin √°nimo de lucro, institutos de investigaci√≥n, instituciones educativas de educaci√≥n superior, en √°reas relacionadas con la biolog√≠a molecular y celular, la gen√©tica, la biodiversidad y conservaci√≥n.',
      'Lo anterior, enmarcados dentro de los principios de di√°logo, equidad, honestidad, pertenencia, respeto, responsabilidad y solidaridad para trabajar en equipos interdisciplinares e interculturales, de forma independiente y en equipo, que pueden resolver problemas en ciencias biol√≥gicas b√°sicas y aplicadas, o problem√°ticas que afectan al medio ambiente y la sociedad.'
    ]
  },
  'estadistica': {
    title: 'Perfil del egresado - Estad√≠stica',
    content: [
      'Los futuros egresados del programa de Estad√≠stica se destacan por su desarrollo integral como profesionales y ciudadanos. Son personas aut√≥nomas y proactivas, capaces de gestionar su aprendizaje de manera efectiva y continuar su crecimiento profesional de forma constante.',
      'Poseen un agudo pensamiento cr√≠tico, que les permite abordar problemas multidisciplinarios e interdisciplinarios, contribuyendo activamente con soluciones innovadoras en diferentes sectores. Adem√°s de un s√≥lido conocimiento t√©cnico en estad√≠stica, los futuros egresados contar√°n con habilidades avanzadas en el manejo de herramientas y t√©cnicas de an√°lisis de datos e inteligencia artificial, lo que les permitir√° contribuir significativamente en la toma de decisiones en diversos campos del conocimiento.',
      'Sus competencias en estad√≠stica y an√°lisis de datos se complementan con una fuerte conciencia social, manifestada en su compromiso con el bienestar de la comunidad y la aplicaci√≥n √©tica de sus conocimientos, que lo impulsa a utilizar sus habilidades para contribuir al desarrollo sostenible y equitativo.',
      'Su formaci√≥n integral los prepara para desempe√±arse con √©xito en diversos roles, tales como analistas de datos, consultores estad√≠sticos, planificadores de pol√≠ticas p√∫blicas, investigadores y profesionales en sectores que abarcan la investigaci√≥n, la industria, la salud, la educaci√≥n y el sector p√∫blico.'
    ]
  },
  'geografia': {
    title: 'Perfil del egresado ‚Äì Geograf√≠a',
    content: [
      'Las ge√≥grafas y los ge√≥grafos egresados del programa de Geograf√≠a de la sede la Paz tendr√°n una mirada amplia y human√≠stica sobre el papel de laGeograf√≠a en la transformaci√≥n de las condiciones inequitativas de la producci√≥n socioespacial, teniendo s√≥lidas bases de formaci√≥n ciudadana y √©tica que marcar√°n su devenir profesional.',
      'Contar√°n con habilidades y destrezas para realizar an√°lisis y diagn√≥sticos sobre las din√°micas territoriales y las transformaciones socioespaciales con un sentido cr√≠tico y articulado con las dimensiones ambientales, sociales, pol√≠ticas y econ√≥micas de los territorios.',
      'As√≠ mismo, tendr√°n competencias fuertemente desarrolladas para el monitoreo, la interpretaci√≥n y el an√°lisis del medio f√≠sico, del ordenamiento territorial, de los impactos ambientales, habilidades en el manejo de las tecnolog√≠as de informaci√≥n geogr√°fica, habilidades para el seguimiento y an√°lisis de procesos sociales urbano - rurales a nivel local, regional, nacional.'
    ]
  },
  'gestion-cultural': {
    title: 'Perfil del egresado ‚Äì Gesti√≥n Cultural y Comunicativa',
    content: [
      'Las personas egresadas del pregrado de Gesti√≥n Cultural y Comunicativa formadas por la Universidad Nacional de Colombia, Sede de La Paz, interrogan, analizan, problematizan e interpretan los contextos socioculturales de las poblaciones, comunidades, organizaciones e instituciones en sus territorios, para aportar creativamente al dise√±o de propuestas que dinamicen, acompa√±en y transformen din√°micas socioculturales orientadas a la construcci√≥n de sociedades m√°s solidarias, expresivas, participativas, diversas y justas. Las personas egresadas est√°n cualificadas para aportar desde su campo de formaci√≥n a la demanda de los sectores cultural, social, comunicativo, educativo, ambiental, ya sea en el √°mbito de car√°cter p√∫blico, privado o mixto.',
      'Las y los gestores culturales y comunicativos de este programa demuestran competencias generales y espec√≠ficas en √°reas de conocimiento afines a la gesti√≥n cultural, la comunicaci√≥n y las artes. Durante su formaci√≥n se apropian de diversas aptitudes investigativas para comprender contextos socioculturales espec√≠ficos desde enfoques territoriales, comunitarios, diferenciales, interculturales y de innovaci√≥n social. Reconocen, valoran y relacionan procesos creativos y procesos comunicativos con las din√°micas socioculturales presentes en los territorios para la gesti√≥n de procesos e interpretar desde los diferentes aspectos multidimensionales del desarrollo humano y sociocultural en el contexto de las nuevas tecnolog√≠as.',
      'Las y los egresados se desempe√±an como agentes de cambio desde las funciones de promotores, organizadores y gestores, que conocen y aplican herramientas pedag√≥gicas, administrativas y comunicativas para interactuar con las comunidades, actores y agentes de diverso tipo. Todo ello se fundamenta en los principios del respeto, el di√°logo, la responsabilidad, la equidad, la solidaridad, la honestidad y la pertenencia.'
    ]
  },
  'ing-biologica': {
    title: 'Perfil del egresado - Ingenier√≠a Biol√≥gica',
    content: [
      'Las personas egresadas del pregrado de Ingenier√≠a Biol√≥gica de la Universidad Nacional de Colombia, Sede La Paz, ser√°n profesionales integrales y multidisciplinarios, con s√≥lida formaci√≥n √©tica y human√≠stica, intelectual, investigativa, t√©cnica, econ√≥mica y en sostenibilidad ambiental. Estar√°n preparados para participar de manera multi e interdisciplinaria en los campos de la ingenier√≠a de procesos y la biotecnolog√≠a, aplicados a diversos sectores como la industria alimentaria, qu√≠mica, farmac√©utica, cosm√©tica, agr√≠cola, pecuaria y biotecnol√≥gica.',
      'Este profesional es capaz de aplicar principios y t√©cnicas de las ciencias de la vida, la biolog√≠a, la ingenier√≠a y la tecnolog√≠a para dise√±ar, desarrollar y mejorar procesos y productos que respondan a las necesidades de la sociedad y el entorno. Posee competencias en el desarrollo y optimizaci√≥n de procesos biol√≥gicos a diferentes escalas, utilizando c√©lulas o sus componentes para la generaci√≥n de productos y servicios. Adem√°s, est√° capacitado para integrar conocimientos cient√≠ficos, tecnol√≥gicos y habilidades administrativas en el dise√±o de soluciones productivas que respondan a los desaf√≠os del sector agroindustrial y biotecnol√≥gico.',
      'Su formaci√≥n incluye el manejo de herramientas inform√°ticas avanzadas para el modelado, simulaci√≥n, optimizaci√≥n y evaluaci√≥n de procesos biol√≥gicos, lo que le permite proponer e implementar alternativas tecnol√≥gicas ambientalmente responsables. Entre estas se destacan la producci√≥n de biomateriales para bioimpresi√≥n 3D, nanomateriales para la administraci√≥n de f√°rmacos, y tecnolog√≠as en energ√≠a, microelectr√≥nica y disposici√≥n de residuos.'
    ]
  },
  'ing-mecatronica': {
    title: 'Perfil del egresado - Ingenier√≠a Mecatr√≥nica',
    content: [
      'El egresado del programa de Ingenier√≠a Mecatr√≥nica de la Universidad Nacional de Colombia, sede La Paz, es un profesional altamente capacitado para desempe√±ar con √©tica, profesionalismo y responsabilidad actividades en electr√≥nica, mec√°nica, ciencia de datos, inteligencia artificial y gesti√≥n empresarial. Lo anterior le dar√° la capacidad de dise√±ar y modelar sistemas de control, dise√±ar y planear e implementar procesos de manufactura, dise√±ar e implementar sistemas automatizados y de control industrial, analizar datos, implementar sistemas de inteligencia y visi√≥n artificial, dise√±ar y construir dispositivos mec√°nicos y electr√≥nicos, programar y automatizar sistemas neum√°ticos, hidr√°ulicos y/o de controladores l√≥gicos programables, dise√±ar, construir y programar robots, desarrollar software, dise√±ar y construir sistemas de agricultura inteligente.',
      'El egresado se destaca por su compromiso con el desarrollo sostenible y su habilidad para el aprendizaje continuo, lo que le permite adaptarse eficientemente a las tecnolog√≠as emergentes. A partir de la identificaci√≥n de necesidades regionales y globales, aplica sus conocimientos y habilidades en la creaci√≥n de proyectos que buscan soluciones pr√°cticas y sostenibles. Su capacidad para trabajar de manera efectiva en equipos multidisciplinarios le permite colaborar en la b√∫squeda de soluciones integrales que beneficien a la sociedad y al medio ambiente. Adem√°s, el egresado del programa est√° preparado para liderar proyectos de alto impacto y resolver desaf√≠os socioecon√≥micos regionales. Por todo lo anterior, el egresado del programa de Ingenier√≠a Mecatr√≥nica es un l√≠der en innovaci√≥n y tecnolog√≠a, comprometido con el desarrollo sostenible y el bienestar social, preparado para enfrentar los desaf√≠os actuales y futuros del campo de la mecatr√≥nica con integridad, creatividad y excelencia profesional.'
    ]
  }
};

// ============================================================
// PERFIL TEMPLATE
// ============================================================
function createPerfilCard(index) {
  const card = document.createElement('div');
  card.className = 'perfil-card expanded';
  card.id = `perfil-${index}`;
  card.dataset.perfilIndex = index;
  
  card.innerHTML = `
    <div class="perfil-header" onclick="togglePerfil(${index})">
      <div class="perfil-header-left">
        <div class="perfil-toggle">
          <span class="material-icons">expand_more</span>
        </div>
        <div class="perfil-title">
          Perfil #${index + 1}
          <span class="perfil-badge incomplete" id="badge-${index}">
            <span class="material-icons">schedule</span>
            Incompleto
          </span>
        </div>
      </div>
      <div class="perfil-header-right">
        <button type="button" class="btn btn-secondary" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;" onclick="event.stopPropagation(); duplicatePerfil(${index})">
          <span class="material-icons" style="font-size: 1rem;">content_copy</span>
          <span>Duplicar</span>
        </button>
        <button type="button" class="btn-remove-perfil" data-perfil-index="${index}" onclick="event.stopPropagation(); removePerfil(${index})">
          <span class="material-icons">delete</span>
          <span>Eliminar</span>
        </button>
      </div>
    </div>

    <div class="perfil-progress" id="progress-${index}">
      <div class="progress-bar-container">
        <div class="progress-bar-fill" style="width: 0%"></div>
      </div>
      <div class="progress-text">0 de 9 campos completados</div>
    </div>

    <div class="perfil-body">
      <div class="perfil-body-inner">
        <div class="form-card">
      <div class="form-section">
        <div class="form-group">
          <label class="form-label" for="tipoModalidad-${index}">
            Tipo de modalidad a vincular <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="tipoModalidad-${index}" value="Pr√°ctica" required>
              Pr√°ctica
            </label>
            <label class="radio-label">
              <input type="radio" name="tipoModalidad-${index}" value="Pasant√≠a">
              Pasant√≠a
            </label>
          </div>
          <div class="form-error" id="error-tipoModalidad-${index}">Selecciona una modalidad.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="descripcionPerfil-${index}">
            Descripci√≥n general del perfil de acuerdo al tipo de modalidad <span class="required">*</span>
          </label>
          <div class="field-wrapper">
            <textarea class="form-textarea" id="descripcionPerfil-${index}" maxlength="500" required></textarea>
            <div class="field-icon" id="icon-descripcionPerfil-${index}">
              <span class="material-icons">check_circle</span>
            </div>
          </div>
          <div class="char-counter" id="counter-descripcionPerfil-${index}">0 / 500</div>
          <div class="form-error" id="error-descripcionPerfil-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="dependenciaProyecto-${index}">
            Dependencia/Proyecto donde se desarrollar√° la Pr√°ctica y/o Pasant√≠a <span class="required">*</span>
          </label>
          <div class="field-wrapper">
            <input type="text" class="form-input" id="dependenciaProyecto-${index}" required>
            <div class="field-icon" id="icon-dependenciaProyecto-${index}">
              <span class="material-icons">check_circle</span>
            </div>
          </div>
          <div class="form-error" id="error-dependenciaProyecto-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="cantidadEstudiantes-${index}">
            Cantidad de estudiantes requeridos/as para este perfil <span class="required">*</span>
          </label>
          <input type="number" class="form-input" id="cantidadEstudiantes-${index}" min="1" required>
          <div class="form-error" id="error-cantidadEstudiantes-${index}">Ingresa un n√∫mero v√°lido.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="modalidadTrabajo-${index}">
            Modalidad <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="Presencial" required>
              Presencial
            </label>
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="Virtual">
              Virtual
            </label>
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="H√≠brida">
              H√≠brida
            </label>
          </div>
          <div class="form-error" id="error-modalidadTrabajo-${index}">Selecciona una modalidad.</div>
        </div>

        <div class="form-group">
          <label class="form-label">
            Programas acad√©micos para los cuales se considera pertinente este perfil <span class="required">*</span>
          </label>
          <div class="checkbox-group" id="programas-${index}">
            ${PROGRAMAS.map(prog => `
              <label class="checkbox-label">
                <input type="checkbox" name="programas-${index}" value="${prog}">
                ${prog}
              </label>
            `).join('')}
          </div>
          <div class="form-error" id="error-programas-${index}">Selecciona al menos un programa.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="competenciasEspecificas-${index}">
            Competencias espec√≠ficas o conocimientos deseados <span class="required">*</span>
          </label>
          <div class="field-wrapper">
            <textarea class="form-textarea" id="competenciasEspecificas-${index}" maxlength="300" required></textarea>
            <div class="field-icon" id="icon-competenciasEspecificas-${index}">
              <span class="material-icons">check_circle</span>
            </div>
          </div>
          <div class="char-counter" id="counter-competenciasEspecificas-${index}">0 / 300</div>
          <div class="form-error" id="error-competenciasEspecificas-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="habilidadesValoradas-${index}">
            Competencias/habilidades o actitudes valoradas <span class="required">*</span>
          </label>
          <div class="field-wrapper">
            <textarea class="form-textarea" id="habilidadesValoradas-${index}" maxlength="300" required></textarea>
            <div class="field-icon" id="icon-habilidadesValoradas-${index}">
              <span class="material-icons">check_circle</span>
            </div>
          </div>
          <div class="char-counter" id="counter-habilidadesValoradas-${index}">0 / 300</div>
          <div class="form-error" id="error-habilidadesValoradas-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="apoyoEstudiante-${index}">
            ¬øLa Direcci√≥n/Dependencia/Proyecto ofrece alg√∫n tipo de apoyo al estudiante en Pr√°ctica y/o Pasant√≠a? <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="SI" required>
              SI
            </label>
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="NO">
              NO
            </label>
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="Otro">
              Otro
            </label>
          </div>
          <div class="form-error" id="error-apoyoEstudiante-${index}">Selecciona una opci√≥n.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="observaciones-${index}">
            Observaciones
          </label>
          <textarea class="form-textarea" id="observaciones-${index}"></textarea>
        </div>
      </div>
      </div>
    </div>
    </div>
  `;
  
  return card;
}

// ============================================================
// ACCORDION TOGGLE
// ============================================================
function togglePerfil(index) {
  const card = document.getElementById(`perfil-${index}`);
  if (!card) return;
  
  if (card.classList.contains('expanded')) {
    card.classList.remove('expanded');
    card.classList.add('collapsed');
  } else {
    card.classList.remove('collapsed');
    card.classList.add('expanded');
  }
}

// ============================================================
// ADD/REMOVE PERFILES
// ============================================================
function addPerfil() {
  const container = document.getElementById('perfilesContainer');
  const card = createPerfilCard(perfilCount);
  container.appendChild(card);
  const currentIndex = perfilCount;
  perfilCount++;
  updatePerfilNumbers();
  updateRemoveButtons();
  
  // Attach completion tracking listeners
  setTimeout(() => {
    attachCompletionListeners(currentIndex);
    updatePerfilCompletion(currentIndex);
  }, 100);
}

function removePerfil(index) {
  const cards = document.querySelectorAll('.perfil-card');
  
  // Validaci√≥n: debe haber al menos 1 perfil
  if (cards.length <= 1) {
    showAlert('Debes mantener al menos un perfil en el formulario.');
    return;
  }
  
  // Mostrar modal de confirmaci√≥n
  showConfirmDelete(index);
}

function confirmRemovePerfil(index) {
  const card = document.getElementById(`perfil-${index}`);
  if (card) {
    card.remove();
    updatePerfilNumbers();
    updateRemoveButtons();
    showToast('Perfil eliminado', 'El perfil ha sido eliminado correctamente.', 'success', 3000);
  }
}

function duplicatePerfil(sourceIndex) {
  // Get source perfil data
  const sourceCard = document.getElementById(`perfil-${sourceIndex}`);
  if (!sourceCard) return;
  
  showToast('Perfil duplicado', 'El perfil ha sido duplicado exitosamente.', 'success', 3000);
  
  // Collect data from source perfil
  const sourceData = {
    tipoModalidad: document.querySelector(`input[name="tipoModalidad-${sourceIndex}"]:checked`)?.value || '',
    descripcionPerfil: document.getElementById(`descripcionPerfil-${sourceIndex}`)?.value || '',
    dependenciaProyecto: document.getElementById(`dependenciaProyecto-${sourceIndex}`)?.value || '',
    cantidadEstudiantes: document.getElementById(`cantidadEstudiantes-${sourceIndex}`)?.value || '',
    modalidadTrabajo: document.querySelector(`input[name="modalidadTrabajo-${sourceIndex}"]:checked`)?.value || '',
    programas: Array.from(document.querySelectorAll(`input[name="programas-${sourceIndex}"]:checked`)).map(cb => cb.value),
    competenciasEspecificas: document.getElementById(`competenciasEspecificas-${sourceIndex}`)?.value || '',
    habilidadesValoradas: document.getElementById(`habilidadesValoradas-${sourceIndex}`)?.value || '',
    apoyoEstudiante: document.querySelector(`input[name="apoyoEstudiante-${sourceIndex}"]:checked`)?.value || '',
    observaciones: document.getElementById(`observaciones-${sourceIndex}`)?.value || ''
  };
  
  // Create new perfil
  const container = document.getElementById('perfilesContainer');
  const newCard = createPerfilCard(perfilCount);
  container.appendChild(newCard);
  const newIndex = perfilCount;
  perfilCount++;
  
  // Populate new perfil with source data
  setTimeout(() => {
    // Text fields
    if (sourceData.descripcionPerfil) document.getElementById(`descripcionPerfil-${newIndex}`).value = sourceData.descripcionPerfil;
    if (sourceData.dependenciaProyecto) document.getElementById(`dependenciaProyecto-${newIndex}`).value = sourceData.dependenciaProyecto;
    if (sourceData.cantidadEstudiantes) document.getElementById(`cantidadEstudiantes-${newIndex}`).value = sourceData.cantidadEstudiantes;
    if (sourceData.competenciasEspecificas) document.getElementById(`competenciasEspecificas-${newIndex}`).value = sourceData.competenciasEspecificas;
    if (sourceData.habilidadesValoradas) document.getElementById(`habilidadesValoradas-${newIndex}`).value = sourceData.habilidadesValoradas;
    if (sourceData.observaciones) document.getElementById(`observaciones-${newIndex}`).value = sourceData.observaciones;
    
    // Radio buttons
    if (sourceData.tipoModalidad) {
      const tipoRadio = document.querySelector(`input[name="tipoModalidad-${newIndex}"][value="${sourceData.tipoModalidad}"]`);
      if (tipoRadio) tipoRadio.checked = true;
    }
    if (sourceData.modalidadTrabajo) {
      const modalidadRadio = document.querySelector(`input[name="modalidadTrabajo-${newIndex}"][value="${sourceData.modalidadTrabajo}"]`);
      if (modalidadRadio) modalidadRadio.checked = true;
    }
    if (sourceData.apoyoEstudiante) {
      const apoyoRadio = document.querySelector(`input[name="apoyoEstudiante-${newIndex}"][value="${sourceData.apoyoEstudiante}"]`);
      if (apoyoRadio) apoyoRadio.checked = true;
    }
    
    // Checkboxes (programas)
    sourceData.programas.forEach(programa => {
      const checkbox = document.querySelector(`input[name="programas-${newIndex}"][value="${programa}"]`);
      if (checkbox) checkbox.checked = true;
    });
    
    updatePerfilNumbers();
    updateRemoveButtons();
    attachCompletionListeners(newIndex);
    updatePerfilCompletion(newIndex);
    
    // Scroll to new perfil
    newCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 100);
}

function updatePerfilNumbers() {
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach((card, idx) => {
    const title = card.querySelector('.perfil-title');
    if (title) {
      title.textContent = `Perfil #${idx + 1}`;
    }
  });
}

function updateRemoveButtons() {
  const cards = document.querySelectorAll('.perfil-card');
  const buttons = document.querySelectorAll('.btn-remove-perfil');
  
  // Si solo hay 1 perfil, ocultar todos los botones
  // Si hay 2+, mostrar todos los botones
  buttons.forEach(btn => {
    if (cards.length <= 1) {
      btn.style.display = 'none';
    } else {
      btn.style.display = 'flex';
    }
  });
}

// ============================================================
// PERFIL COMPLETION TRACKING
// ============================================================
function updatePerfilCompletion(index) {
  const TOTAL_FIELDS = 9; // Total required fields per perfil
  let completed = 0;
  
  // Text fields
  const textFields = [
    `descripcionPerfil-${index}`,
    `dependenciaProyecto-${index}`,
    `cantidadEstudiantes-${index}`,
    `competenciasEspecificas-${index}`,
    `habilidadesValoradas-${index}`
  ];
  
  textFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field && field.value.trim() !== '') {
      completed++;
    }
  });
  
  // Radio groups
  const radioGroups = [
    `tipoModalidad-${index}`,
    `modalidadTrabajo-${index}`,
    `apoyoEstudiante-${index}`
  ];
  
  radioGroups.forEach(groupName => {
    const checked = document.querySelector(`input[name="${groupName}"]:checked`);
    if (checked) {
      completed++;
    }
  });
  
  // Checkbox group (programas)
  const checkedProgramas = document.querySelectorAll(`input[name="programas-${index}"]:checked`);
  if (checkedProgramas.length > 0) {
    completed++;
  }
  
  // Update progress bar
  const progressContainer = document.getElementById(`progress-${index}`);
  if (progressContainer) {
    const progressBar = progressContainer.querySelector('.progress-bar-fill');
    const progressText = progressContainer.querySelector('.progress-text');
    const percentage = (completed / TOTAL_FIELDS) * 100;
    
    if (progressBar) progressBar.style.width = percentage + '%';
    if (progressText) progressText.textContent = `${completed} de ${TOTAL_FIELDS} campos completados`;
  }
  
  // Update badge
  const badge = document.getElementById(`badge-${index}`);
  if (badge) {
    if (completed === TOTAL_FIELDS) {
      badge.className = 'perfil-badge complete';
      badge.innerHTML = '<span class="material-icons">check_circle</span> Completo';
    } else {
      badge.className = 'perfil-badge incomplete';
      badge.innerHTML = '<span class="material-icons">schedule</span> Incompleto';
    }
  }
}

function attachCompletionListeners(index) {
  // Text inputs and textareas
  const textFields = [
    `descripcionPerfil-${index}`,
    `dependenciaProyecto-${index}`,
    `cantidadEstudiantes-${index}`,
    `competenciasEspecificas-${index}`,
    `habilidadesValoradas-${index}`
  ];
  
  textFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
      field.addEventListener('input', () => {
        updatePerfilCompletion(index);
        updateFieldVisualState(fieldId);
      });
      field.addEventListener('blur', () => {
        updatePerfilCompletion(index);
        updateFieldVisualState(fieldId);
      });
      
      // Initialize visual state
      updateFieldVisualState(fieldId);
    }
  });
  
  // Radio groups
  const radioGroups = [
    `tipoModalidad-${index}`,
    `modalidadTrabajo-${index}`,
    `apoyoEstudiante-${index}`
  ];
  
  radioGroups.forEach(groupName => {
    const radios = document.querySelectorAll(`input[name="${groupName}"]`);
    radios.forEach(radio => {
      radio.addEventListener('change', () => updatePerfilCompletion(index));
    });
  });
  
  // Checkbox group
  const checkboxes = document.querySelectorAll(`input[name="programas-${index}"]`);
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', () => updatePerfilCompletion(index));
  });
}

// ============================================================
// VALIDATION
// ============================================================
function validateField(field) {
  const errorEl = document.getElementById(`error-${field.id}`);
  
  if (field.type === 'email' && field.value && !field.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    field.classList.add('error');
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (field.required && !field.value.trim()) {
    field.classList.add('error');
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  field.classList.remove('error');
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateRadioGroup(name, index) {
  const radios = document.querySelectorAll(`input[name="${name}"]`);
  const errorEl = document.getElementById(`error-${name}`);
  const checked = Array.from(radios).some(r => r.checked);
  
  if (!checked) {
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateCheckboxGroup(index) {
  const checkboxes = document.querySelectorAll(`input[name="programas-${index}"]:checked`);
  const errorEl = document.getElementById(`error-programas-${index}`);
  
  if (checkboxes.length === 0) {
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateForm() {
  let isValid = true;
  
  // Validate dependencia fields
  ['nombreDependencia', 'correoContacto', 'responsable'].forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (!validateField(field)) isValid = false;
  });
  
  // Validate each perfil
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach((card, idx) => {
    const index = card.dataset.perfilIndex;
    
    // Validate text fields
    ['descripcionPerfil', 'dependenciaProyecto', 'cantidadEstudiantes', 'competenciasEspecificas', 'habilidadesValoradas'].forEach(fieldName => {
      const field = document.getElementById(`${fieldName}-${index}`);
      if (field && !validateField(field)) isValid = false;
    });
    
    // Validate radio groups
    if (!validateRadioGroup(`tipoModalidad-${index}`, index)) isValid = false;
    if (!validateRadioGroup(`modalidadTrabajo-${index}`, index)) isValid = false;
    if (!validateRadioGroup(`apoyoEstudiante-${index}`, index)) isValid = false;
    
    // Validate checkbox group
    if (!validateCheckboxGroup(index)) isValid = false;
  });
  
  return isValid;
}

// ============================================================
// FIELD VISUAL STATE
// ============================================================
function updateFieldVisualState(fieldId) {
  const field = document.getElementById(fieldId);
  if (!field) return;
  
  const icon = document.getElementById(`icon-${fieldId}`);
  const counter = document.getElementById(`counter-${fieldId}`);
  const value = field.value.trim();
  
  // Update visual check icon
  if (icon) {
    if (value.length > 0) {
      icon.classList.add('visible');
      field.classList.add('valid');
    } else {
      icon.classList.remove('visible');
      field.classList.remove('valid');
    }
  }
  
  // Update character counter for textareas
  if (counter && field.tagName === 'TEXTAREA') {
    const maxLength = field.getAttribute('maxlength') || 500;
    const currentLength = value.length;
    counter.textContent = `${currentLength} / ${maxLength}`;
    
    // Warning when approaching limit (>90%)
    if (currentLength > maxLength * 0.9) {
      counter.classList.add('warning');
    } else {
      counter.classList.remove('warning');
    }
  }
}

// ============================================================
// COLLECT FORM DATA
// ============================================================
function collectFormData() {
  const data = {
    nombreDependencia: document.getElementById('nombreDependencia').value.trim(),
    correoContacto: document.getElementById('correoContacto').value.trim(),
    responsable: document.getElementById('responsable').value.trim(),
    perfiles: []
  };
  
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach(card => {
    const index = card.dataset.perfilIndex;
    
    const tipoModalidad = document.querySelector(`input[name="tipoModalidad-${index}"]:checked`);
    const modalidadTrabajo = document.querySelector(`input[name="modalidadTrabajo-${index}"]:checked`);
    const apoyoEstudiante = document.querySelector(`input[name="apoyoEstudiante-${index}"]:checked`);
    const programas = Array.from(document.querySelectorAll(`input[name="programas-${index}"]:checked`)).map(cb => cb.value);
    
    data.perfiles.push({
      tipoModalidad: tipoModalidad ? tipoModalidad.value : '',
      descripcionPerfil: document.getElementById(`descripcionPerfil-${index}`).value.trim(),
      dependenciaProyecto: document.getElementById(`dependenciaProyecto-${index}`).value.trim(),
      cantidadEstudiantes: document.getElementById(`cantidadEstudiantes-${index}`).value.trim(),
      modalidadTrabajo: modalidadTrabajo ? modalidadTrabajo.value : '',
      programas: programas,
      competenciasEspecificas: document.getElementById(`competenciasEspecificas-${index}`).value.trim(),
      habilidadesValoradas: document.getElementById(`habilidadesValoradas-${index}`).value.trim(),
      apoyoEstudiante: apoyoEstudiante ? apoyoEstudiante.value : '',
      observaciones: document.getElementById(`observaciones-${index}`).value.trim()
    });
  });
  
  return data;
}

// ============================================================
// SUBMIT FORM
// ============================================================
function showError(message) {
  const errorAlert = document.getElementById('errorAlert');
  const errorMessage = document.getElementById('errorMessage');
  errorMessage.textContent = message;
  errorAlert.classList.add('visible');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideError() {
  document.getElementById('errorAlert').classList.remove('visible');
}

function showLoading() {
  document.getElementById('loadingOverlay').classList.add('visible');
}

function hideLoading() {
  document.getElementById('loadingOverlay').classList.remove('visible');
}

function showSuccess() {
  document.getElementById('mainForm').style.display = 'none';
  document.getElementById('successMessage').classList.add('visible');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

async function handleSubmit(e) {
  e.preventDefault();
  hideError();
  
  if (!validateForm()) {
    showError('Por favor completa todos los campos obligatorios.');
    return;
  }
  
  const formData = collectFormData();
  
  if (formData.perfiles.length === 0) {
    showError('Debes agregar al menos un perfil.');
    return;
  }
  
  showLoading();
  
  try {
    // Check if google.script.run is available (Apps Script environment)
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run
        .withSuccessHandler(function(response) {
          hideLoading();
          if (response.success) {
            showSuccess();
          } else {
            showError(response.error || 'Ocurri√≥ un error al enviar el formulario. Por favor intenta nuevamente.');
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showError('Error al enviar el formulario: ' + error.message);
        })
        .submitBancoPerfiles(formData);
    } else {
      // Local development mock
      console.log('MOCK SUBMISSION:', formData);
      setTimeout(() => {
        hideLoading();
        showSuccess();
      }, 2000);
    }
  } catch (error) {
    hideLoading();
    showError('Error inesperado: ' + error.message);
  }
}

// ============================================================
// MODAL FUNCTIONS
// ============================================================
function openModal(programaKey) {
  const perfil = PERFILES_EGRESADOS[programaKey];
  if (!perfil) return;
  
  const modal = document.getElementById('modalPerfil');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  
  modalTitle.textContent = perfil.title;
  modalBody.innerHTML = perfil.content.map(p => `<p>${p}</p>`).join('');
  
  modal.classList.add('visible');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  const modal = document.getElementById('modalPerfil');
  modal.classList.remove('visible');
  document.body.style.overflow = '';
}

// ============================================================
// PREVIEW MODAL
// ============================================================
function openPreviewModal() {
  // Validate form first
  if (!validateForm()) {
    showError('Por favor completa todos los campos obligatorios antes de ver la vista previa.');
    return;
  }
  
  const formData = collectFormData();
  
  if (formData.perfiles.length === 0) {
    showError('Debes agregar al menos un perfil.');
    return;
  }
  
  // Generate preview HTML
  const previewBody = document.getElementById('previewBody');
  
  let html = `
    <div class="preview-section">
      <div class="preview-section-title">Datos de la Direcci√≥n/Dependencia/Proyecto</div>
      <div class="preview-field">
        <div class="preview-label">Nombre de la Direcci√≥n/Dependencia/Proyecto</div>
        <div class="preview-value">${escapeHtml(formData.nombreDependencia)}</div>
      </div>
      <div class="preview-field">
        <div class="preview-label">Correo electr√≥nico</div>
        <div class="preview-value">${escapeHtml(formData.correoContacto)}</div>
      </div>
      <div class="preview-field">
        <div class="preview-label">Responsable</div>
        <div class="preview-value">${escapeHtml(formData.responsable)}</div>
      </div>
    </div>
    
    <div class="preview-section">
      <div class="preview-section-title">Perfiles (${formData.perfiles.length})</div>
  `;
  
  formData.perfiles.forEach((perfil, idx) => {
    html += `
      <div class="preview-perfil-card">
        <div class="preview-perfil-header">
          <div class="preview-perfil-title">Perfil #${idx + 1}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Tipo de modalidad</div>
          <div class="preview-value">${escapeHtml(perfil.tipoModalidad)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Descripci√≥n del perfil</div>
          <div class="preview-value">${escapeHtml(perfil.descripcionPerfil)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Dependencia/Proyecto</div>
          <div class="preview-value">${escapeHtml(perfil.dependenciaProyecto)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Cantidad de estudiantes requeridos</div>
          <div class="preview-value">${escapeHtml(perfil.cantidadEstudiantes)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Modalidad de trabajo</div>
          <div class="preview-value">${escapeHtml(perfil.modalidadTrabajo)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Programas acad√©micos</div>
          <div class="preview-value">${perfil.programas.map(p => escapeHtml(p)).join(', ')}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Competencias espec√≠ficas</div>
          <div class="preview-value">${escapeHtml(perfil.competenciasEspecificas)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Habilidades valoradas</div>
          <div class="preview-value">${escapeHtml(perfil.habilidadesValoradas)}</div>
        </div>
        
        <div class="preview-field">
          <div class="preview-label">Apoyo al estudiante</div>
          <div class="preview-value">${escapeHtml(perfil.apoyoEstudiante)}</div>
        </div>
        
        ${perfil.observaciones ? `
          <div class="preview-field">
            <div class="preview-label">Observaciones</div>
            <div class="preview-value">${escapeHtml(perfil.observaciones)}</div>
          </div>
        ` : ''}
      </div>
    `;
  });
  
  html += `</div>`;
  
  previewBody.innerHTML = html;
  
  const modal = document.getElementById('previewModal');
  modal.classList.add('visible');
  document.body.style.overflow = 'hidden';
}

function closePreviewModal() {
  const modal = document.getElementById('previewModal');
  modal.classList.remove('visible');
  document.body.style.overflow = '';
}

function escapeHtml(text) {
  if (!text) return '';
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ============================================================
// CONFIRM MODAL (Generic)
// ============================================================
let pendingConfirmCallback = null;

function showConfirm(title, message, onConfirm, iconType = 'warning') {
  const modal = document.getElementById('confirmModal');
  const confirmTitle = document.getElementById('confirmTitle');
  const confirmMessage = document.getElementById('confirmMessage');
  const confirmIcon = document.getElementById('confirmIcon');
  const btnAccept = document.getElementById('btnAcceptConfirm');
  
  confirmTitle.textContent = title;
  confirmMessage.textContent = message;
  
  // Update icon
  const iconMap = {
    warning: 'warning',
    error: 'error',
    info: 'info',
    question: 'help_outline'
  };
  confirmIcon.querySelector('.material-icons').textContent = iconMap[iconType] || 'warning';
  
  // Update button text based on icon
  if (iconType === 'warning' || iconType === 'error') {
    btnAccept.textContent = 'Eliminar';
  } else {
    btnAccept.textContent = 'Aceptar';
  }
  
  pendingConfirmCallback = onConfirm;
  modal.classList.add('visible');
  document.body.style.overflow = 'hidden';
}

function hideConfirm() {
  pendingConfirmCallback = null;
  const modal = document.getElementById('confirmModal');
  modal.classList.remove('visible');
  document.body.style.overflow = '';
}

function acceptConfirm() {
  if (pendingConfirmCallback) {
    pendingConfirmCallback();
  }
  hideConfirm();
}

// Specific confirm functions
function showConfirmDelete(index) {
  // Calcular el n√∫mero del perfil basado en su posici√≥n actual
  const cards = document.querySelectorAll('.perfil-card');
  let perfilNumber = 1;
  
  cards.forEach((card, idx) => {
    if (card.dataset.perfilIndex == index) {
      perfilNumber = idx + 1;
    }
  });
  
  showConfirm(
    `¬øEliminar Perfil #${perfilNumber}?`,
    `¬øEst√°s seguro de que deseas eliminar el Perfil #${perfilNumber}? Esta acci√≥n no se puede deshacer.`,
    () => confirmRemovePerfil(index),
    'warning'
  );
}

function showAlert(message) {
  showToast('Atenci√≥n', message, 'warning');
}

// ============================================================
// TOAST NOTIFICATIONS
// ============================================================
function showToast(title, message, type = 'info', duration = 5000) {
  const container = document.getElementById('toastContainer');
  
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  
  const iconMap = {
    success: 'check_circle',
    error: 'error',
    warning: 'warning',
    info: 'info'
  };
  
  toast.innerHTML = `
    <div class="toast-icon">
      <span class="material-icons">${iconMap[type] || 'info'}</span>
    </div>
    <div class="toast-content">
      <div class="toast-title">${title}</div>
      <div class="toast-message">${message}</div>
    </div>
    <button class="toast-close" onclick="this.parentElement.remove()">
      <span class="material-icons">close</span>
    </button>
  `;
  
  container.appendChild(toast);
  
  // Trigger animation
  setTimeout(() => toast.classList.add('show'), 10);
  
  // Auto-remove after duration
  if (duration > 0) {
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, duration);
  }
}

// ============================================================
// EVENT LISTENERS
// ============================================================
document.getElementById('btnAddPerfil').addEventListener('click', addPerfil);

document.getElementById('btnReset').addEventListener('click', function() {
  showConfirm(
    '¬øLimpiar formulario?',
    '¬øEst√°s seguro de que deseas limpiar el formulario? Se perder√°n todos los datos ingresados.',
    () => {
      document.getElementById('bancoPerfilesForm').reset();
      document.getElementById('perfilesContainer').innerHTML = '';
      perfilCount = 0;
      addPerfil();
      hideError();
      showToast('Formulario limpiado', 'El formulario ha sido reiniciado correctamente.', 'info', 3000);
    },
    'question'
  );
});

document.getElementById('btnPreview').addEventListener('click', openPreviewModal);

document.getElementById('bancoPerfilesForm').addEventListener('submit', handleSubmit);

// Add real-time validation
document.querySelectorAll('.form-input, .form-textarea, .form-select').forEach(field => {
  field.addEventListener('blur', function() {
    validateField(this);
  });
});

// ============================================================
// INITIALIZATION
// ============================================================
window.addEventListener('DOMContentLoaded', function() {
  // Add first perfil automatically
  addPerfil();
  
  // Initialize: hide remove button when only 1 perfil
  updateRemoveButtons();
  
  // Add click listeners to programa list items
  document.querySelectorAll('.info-box li[data-programa]').forEach(item => {
    item.addEventListener('click', function() {
      const programaKey = this.getAttribute('data-programa');
      openModal(programaKey);
    });
  });
  
  // Modal close handlers
  document.getElementById('btnCloseModal').addEventListener('click', closeModal);
  document.getElementById('modalPerfil').addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
  
  // Preview modal handlers
  document.getElementById('btnClosePreview').addEventListener('click', closePreviewModal);
  document.getElementById('btnEditFromPreview').addEventListener('click', closePreviewModal);
  document.getElementById('btnSubmitFromPreview').addEventListener('click', function() {
    closePreviewModal();
    document.getElementById('bancoPerfilesForm').dispatchEvent(new Event('submit'));
  });
  document.getElementById('previewModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closePreviewModal();
    }
  });
  
  // Confirm modal handlers
  document.getElementById('btnAcceptConfirm').addEventListener('click', acceptConfirm);
  document.getElementById('btnCancelConfirm').addEventListener('click', hideConfirm);
  
  document.getElementById('confirmModal').addEventListener('click', function(e) {
    if (e.target === this) {
      hideConfirm();
    }
  });
  
  // Close modals on ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      const confirmModal = document.getElementById('confirmModal');
      const perfilModal = document.getElementById('modalPerfil');
      const previewModal = document.getElementById('previewModal');
      
      if (confirmModal.classList.contains('visible')) {
        hideConfirm();
      } else if (previewModal.classList.contains('visible')) {
        closePreviewModal();
      } else if (perfilModal.classList.contains('visible')) {
        closeModal();
      }
    }
  });
  
  // Auto-resize iframe
  function adjustHeight() {
    const height = Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight,
      document.body.offsetHeight,
      document.documentElement.offsetHeight
    );
    window.parent.postMessage({ type: 'setHeight', height: height }, '*');
  }
  
  adjustHeight();
  
  // Observe DOM changes
  const observer = new MutationObserver(adjustHeight);
  observer.observe(document.body, { childList: true, subtree: true, attributes: true });
  
  // Adjust on window resize
  window.addEventListener('resize', adjustHeight);
});
</script>

</body>
</html>
