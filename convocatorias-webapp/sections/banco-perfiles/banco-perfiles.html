<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banco de Perfiles - UNAL Sede de La Paz</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    :root {
      --unal-green: #4CAF50;
      --unal-green-dark: #388E3C;
      --unal-green-light: #C8E6C9;
      --unal-green-bg: #f0f9f0;
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #64748b;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg-primary: #f8fafc;
      --bg-card: #ffffff;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
      --radius: 12px;
      --radius-sm: 8px;
      --radius-lg: 16px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* ========== HEADER ========== */
    .header {
      background: linear-gradient(135deg, var(--unal-green) 0%, var(--unal-green-dark) 100%);
      color: white;
      padding: 2.5rem 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      box-shadow: var(--shadow-lg);
    }

    .header h1 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      line-height: 1.3;
    }

    .header p {
      opacity: 0.95;
      font-size: 0.95rem;
      line-height: 1.6;
    }

    /* ========== INFO BOX ========== */
    .info-box {
      background: var(--unal-green-bg);
      border-left: 4px solid var(--unal-green);
      padding: 1.25rem;
      border-radius: 0 var(--radius) var(--radius) 0;
      margin-bottom: 2rem;
    }

    .info-box h3 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--unal-green-dark);
      margin-bottom: 0.75rem;
    }

    .info-box p {
      font-size: 0.9rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .info-box ul {
      margin-left: 1.5rem;
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .info-box li {
      margin-bottom: 0.25rem;
    }

    /* ========== FORM CARD ========== */
    .form-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .section-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border);
    }

    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.4rem;
    }

    .required {
      color: var(--danger);
      margin-left: 0.2rem;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-family: inherit;
      color: var(--text-primary);
      background: var(--bg-card);
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--unal-green);
      box-shadow: 0 0 0 3px var(--unal-green-light);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-error {
      color: var(--danger);
      font-size: 0.8rem;
      margin-top: 0.25rem;
      display: none;
    }

    .form-error.visible {
      display: block;
    }

    .form-input.error,
    .form-textarea.error,
    .form-select.error {
      border-color: var(--danger);
    }

    /* ========== CHECKBOX GROUP ========== */
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-primary);
      cursor: pointer;
    }

    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--unal-green);
      cursor: pointer;
    }

    /* ========== RADIO GROUP ========== */
    .radio-group {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    .radio-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-primary);
      cursor: pointer;
    }

    .radio-label input[type="radio"] {
      width: 18px;
      height: 18px;
      accent-color: var(--unal-green);
      cursor: pointer;
    }

    /* ========== PERFIL CARD ========== */
    .perfil-card {
      background: var(--bg-primary);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      position: relative;
    }

    .perfil-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--unal-green-light);
    }

    .perfil-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--unal-green-dark);
    }

    .btn-remove-perfil {
      background: var(--danger);
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      transition: background 0.2s;
    }

    .btn-remove-perfil:hover {
      background: #dc2626;
    }

    .btn-remove-perfil .material-icons {
      font-size: 1rem;
    }

    /* ========== BUTTONS ========== */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      touch-action: manipulation;
    }

    .btn-primary {
      background: var(--unal-green);
      color: white;
    }

    .btn-primary:hover {
      background: var(--unal-green-dark);
    }

    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-secondary);
      border: 2px solid var(--border);
    }

    .btn-secondary:hover {
      border-color: var(--unal-green);
      color: var(--unal-green);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn .material-icons {
      font-size: 1.2rem;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid var(--border);
    }

    .btn-add-perfil {
      width: 100%;
      justify-content: center;
      margin-top: 1rem;
    }

    /* ========== SUCCESS MESSAGE ========== */
    .success-message {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      padding: 3rem 2rem;
      text-align: center;
      display: none;
    }

    .success-message.visible {
      display: block;
    }

    .success-message .material-icons {
      font-size: 4rem;
      color: var(--success);
      margin-bottom: 1rem;
    }

    .success-message h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .success-message p {
      font-size: 1rem;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    /* ========== ERROR ALERT ========== */
    .error-alert {
      background: #fef2f2;
      border: 1px solid #fecaca;
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1.5rem;
      display: none;
    }

    .error-alert.visible {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .error-alert .material-icons {
      color: var(--danger);
      flex-shrink: 0;
    }

    .error-alert p {
      font-size: 0.875rem;
      color: #dc2626;
      margin: 0;
    }

    /* ========== LOADING OVERLAY ========== */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .loading-overlay.visible {
      display: flex;
    }

    .loading-content {
      background: var(--bg-card);
      padding: 2rem;
      border-radius: var(--radius);
      text-align: center;
      box-shadow: var(--shadow-lg);
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border);
      border-top-color: var(--unal-green);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-content p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
      body {
        padding: 1rem 0.5rem;
      }

      .header {
        padding: 2rem 1.5rem;
      }

      .header h1 {
        font-size: 1.4rem;
      }

      .form-card {
        padding: 1.5rem;
      }

      .perfil-card {
        padding: 1.25rem;
      }

      .form-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .radio-group {
        flex-direction: column;
        gap: 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .header h1 {
        font-size: 1.25rem;
      }

      .form-card {
        padding: 1.25rem;
      }

      .perfil-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.75rem;
      }
    }
  </style>
</head>
<body>

<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <h1>Convocatoria Interna - Banco de Perfiles de Pr√°cticas y Pasant√≠as</h1>
    <p>Universidad Nacional de Colombia ‚Äì Sede de La Paz - 2026-1</p>
  </div>

  <!-- INFO BOX -->
  <div class="info-box">
    <h3>Convocatoria a Dependencias de la Sede de La Paz</h3>
    <p>La Universidad Nacional de Colombia ‚Äì Sede de La Paz, a trav√©s de su Escuela de Pregrados, se encuentra estructurando un banco de perfiles para fortalecer la articulaci√≥n entre los programas acad√©micos y las dependencias de la Sede.</p>
    <p><strong>El prop√≥sito es identificar oportunidades para nuestros estudiantes</strong>, en funci√≥n de las necesidades de las dependencias y/o proyectos internos de la Universidad.</p>
    <p>Agradecemos a las dependencias de la Sede diligenciar este formulario con la informaci√≥n de los perfiles disponibles para acoger estudiantes en la modalidad de pr√°ctica y/o pasant√≠a, de acuerdo con las siguientes √°reas de formaci√≥n:</p>
    <ul>
      <li>üîπ L001 - Biolog√≠a</li>
      <li>üîπ L002 - Estad√≠stica</li>
      <li>üîπ L003 - Geograf√≠a</li>
      <li>üîπ L004 - Gesti√≥n Cultural y Comunicativa</li>
      <li>üîπ L005 - Ingenier√≠a Biol√≥gica</li>
      <li>üîπ L006 - Ingenier√≠a Mecatr√≥nica</li>
    </ul>
  </div>

  <!-- ERROR ALERT -->
  <div class="error-alert" id="errorAlert">
    <span class="material-icons">error</span>
    <p id="errorMessage"></p>
  </div>

  <!-- MAIN FORM -->
  <div id="mainForm">
    <form id="bancoPerfilesForm">
      
      <!-- DATOS DE LA DEPENDENCIA -->
      <div class="form-card">
        <div class="form-section">
          <div class="section-title">Datos de la Direcci√≥n/Dependencia/Proyecto</div>
          
          <div class="form-group">
            <label class="form-label" for="nombreDependencia">
              Nombre de la Direcci√≥n/Dependencia/Proyecto <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="nombreDependencia" required>
            <div class="form-error" id="error-nombreDependencia">Este campo es obligatorio.</div>
          </div>

          <div class="form-group">
            <label class="form-label" for="correoContacto">
              Correo electr√≥nico <span class="required">*</span>
            </label>
            <input type="email" class="form-input" id="correoContacto" required>
            <div class="form-error" id="error-correoContacto">Ingresa un correo v√°lido.</div>
          </div>

          <div class="form-group">
            <label class="form-label" for="responsable">
              Responsable <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="responsable" required>
            <div class="form-error" id="error-responsable">Este campo es obligatorio.</div>
          </div>
        </div>
      </div>

      <!-- PERFILES CONTAINER -->
      <div id="perfilesContainer"></div>

      <!-- ADD PERFIL BUTTON -->
      <button type="button" class="btn btn-secondary btn-add-perfil" id="btnAddPerfil">
        <span class="material-icons">add_circle</span>
        Agregar otro perfil
      </button>

      <!-- FORM ACTIONS -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" id="btnReset">
          <span class="material-icons">restart_alt</span>
          Limpiar formulario
        </button>
        <button type="submit" class="btn btn-primary" id="btnSubmit">
          <span class="material-icons">send</span>
          Enviar formulario
        </button>
      </div>

    </form>
  </div>

  <!-- SUCCESS MESSAGE -->
  <div class="success-message" id="successMessage">
    <span class="material-icons">check_circle</span>
    <h2>¬°Formulario enviado exitosamente!</h2>
    <p>Gracias por tu colaboraci√≥n. Hemos recibido la informaci√≥n de los perfiles y ser√° procesada por nuestro equipo.</p>
  </div>

</div>

<!-- LOADING OVERLAY -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Enviando formulario...</p>
  </div>
</div>

<script>
// ============================================================
// GLOBAL STATE
// ============================================================
let perfilCount = 0;
const PROGRAMAS = [
  'L001 - Biolog√≠a',
  'L002 - Estad√≠stica',
  'L003 - Geograf√≠a',
  'L004 - Gesti√≥n Cultural y Comunicativa',
  'L005 - Ingenier√≠a Biol√≥gica',
  'L006 - Ingenier√≠a Mecatr√≥nica'
];

// ============================================================
// PERFIL TEMPLATE
// ============================================================
function createPerfilCard(index) {
  const card = document.createElement('div');
  card.className = 'perfil-card';
  card.id = `perfil-${index}`;
  card.dataset.perfilIndex = index;
  
  card.innerHTML = `
    <div class="perfil-header">
      <div class="perfil-title">Perfil #${index + 1}</div>
      ${index > 0 ? `
        <button type="button" class="btn-remove-perfil" onclick="removePerfil(${index})">
          <span class="material-icons">delete</span>
          Eliminar perfil
        </button>
      ` : ''}
    </div>

    <div class="form-card">
      <div class="form-section">
        <div class="form-group">
          <label class="form-label" for="tipoModalidad-${index}">
            Tipo de modalidad a vincular <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="tipoModalidad-${index}" value="Pr√°ctica" required>
              Pr√°ctica
            </label>
            <label class="radio-label">
              <input type="radio" name="tipoModalidad-${index}" value="Pasant√≠a">
              Pasant√≠a
            </label>
          </div>
          <div class="form-error" id="error-tipoModalidad-${index}">Selecciona una modalidad.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="descripcionPerfil-${index}">
            Descripci√≥n general del perfil de acuerdo al tipo de modalidad <span class="required">*</span>
          </label>
          <textarea class="form-textarea" id="descripcionPerfil-${index}" required></textarea>
          <div class="form-error" id="error-descripcionPerfil-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="dependenciaProyecto-${index}">
            Dependencia/Proyecto donde se desarrollar√° la Pr√°ctica y/o Pasant√≠a <span class="required">*</span>
          </label>
          <input type="text" class="form-input" id="dependenciaProyecto-${index}" required>
          <div class="form-error" id="error-dependenciaProyecto-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="cantidadEstudiantes-${index}">
            Cantidad de estudiantes requeridos/as para este perfil <span class="required">*</span>
          </label>
          <input type="number" class="form-input" id="cantidadEstudiantes-${index}" min="1" required>
          <div class="form-error" id="error-cantidadEstudiantes-${index}">Ingresa un n√∫mero v√°lido.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="modalidadTrabajo-${index}">
            Modalidad <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="Presencial" required>
              Presencial
            </label>
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="Virtual">
              Virtual
            </label>
            <label class="radio-label">
              <input type="radio" name="modalidadTrabajo-${index}" value="H√≠brida">
              H√≠brida
            </label>
          </div>
          <div class="form-error" id="error-modalidadTrabajo-${index}">Selecciona una modalidad.</div>
        </div>

        <div class="form-group">
          <label class="form-label">
            Programas acad√©micos para los cuales se considera pertinente este perfil <span class="required">*</span>
          </label>
          <div class="checkbox-group" id="programas-${index}">
            ${PROGRAMAS.map(prog => `
              <label class="checkbox-label">
                <input type="checkbox" name="programas-${index}" value="${prog}">
                ${prog}
              </label>
            `).join('')}
          </div>
          <div class="form-error" id="error-programas-${index}">Selecciona al menos un programa.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="competenciasEspecificas-${index}">
            Competencias espec√≠ficas o conocimientos deseados <span class="required">*</span>
          </label>
          <textarea class="form-textarea" id="competenciasEspecificas-${index}" required></textarea>
          <div class="form-error" id="error-competenciasEspecificas-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="habilidadesValoradas-${index}">
            Competencias/habilidades o actitudes valoradas <span class="required">*</span>
          </label>
          <textarea class="form-textarea" id="habilidadesValoradas-${index}" required></textarea>
          <div class="form-error" id="error-habilidadesValoradas-${index}">Este campo es obligatorio.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="apoyoEstudiante-${index}">
            ¬øLa Direcci√≥n/Dependencia/Proyecto ofrece alg√∫n tipo de apoyo al estudiante en Pr√°ctica y/o Pasant√≠a? <span class="required">*</span>
          </label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="SI" required>
              SI
            </label>
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="NO">
              NO
            </label>
            <label class="radio-label">
              <input type="radio" name="apoyoEstudiante-${index}" value="Otro">
              Otro
            </label>
          </div>
          <div class="form-error" id="error-apoyoEstudiante-${index}">Selecciona una opci√≥n.</div>
        </div>

        <div class="form-group">
          <label class="form-label" for="observaciones-${index}">
            Observaciones
          </label>
          <textarea class="form-textarea" id="observaciones-${index}"></textarea>
        </div>
      </div>
    </div>
  `;
  
  return card;
}

// ============================================================
// ADD/REMOVE PERFILES
// ============================================================
function addPerfil() {
  const container = document.getElementById('perfilesContainer');
  const card = createPerfilCard(perfilCount);
  container.appendChild(card);
  perfilCount++;
  updatePerfilNumbers();
}

function removePerfil(index) {
  const card = document.getElementById(`perfil-${index}`);
  if (card) {
    card.remove();
    updatePerfilNumbers();
  }
}

function updatePerfilNumbers() {
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach((card, idx) => {
    const title = card.querySelector('.perfil-title');
    if (title) {
      title.textContent = `Perfil #${idx + 1}`;
    }
  });
}

// ============================================================
// VALIDATION
// ============================================================
function validateField(field) {
  const errorEl = document.getElementById(`error-${field.id}`);
  
  if (field.type === 'email' && field.value && !field.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
    field.classList.add('error');
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (field.required && !field.value.trim()) {
    field.classList.add('error');
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  field.classList.remove('error');
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateRadioGroup(name, index) {
  const radios = document.querySelectorAll(`input[name="${name}"]`);
  const errorEl = document.getElementById(`error-${name}`);
  const checked = Array.from(radios).some(r => r.checked);
  
  if (!checked) {
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateCheckboxGroup(index) {
  const checkboxes = document.querySelectorAll(`input[name="programas-${index}"]:checked`);
  const errorEl = document.getElementById(`error-programas-${index}`);
  
  if (checkboxes.length === 0) {
    if (errorEl) errorEl.classList.add('visible');
    return false;
  }
  
  if (errorEl) errorEl.classList.remove('visible');
  return true;
}

function validateForm() {
  let isValid = true;
  
  // Validate dependencia fields
  ['nombreDependencia', 'correoContacto', 'responsable'].forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (!validateField(field)) isValid = false;
  });
  
  // Validate each perfil
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach((card, idx) => {
    const index = card.dataset.perfilIndex;
    
    // Validate text fields
    ['descripcionPerfil', 'dependenciaProyecto', 'cantidadEstudiantes', 'competenciasEspecificas', 'habilidadesValoradas'].forEach(fieldName => {
      const field = document.getElementById(`${fieldName}-${index}`);
      if (field && !validateField(field)) isValid = false;
    });
    
    // Validate radio groups
    if (!validateRadioGroup(`tipoModalidad-${index}`, index)) isValid = false;
    if (!validateRadioGroup(`modalidadTrabajo-${index}`, index)) isValid = false;
    if (!validateRadioGroup(`apoyoEstudiante-${index}`, index)) isValid = false;
    
    // Validate checkbox group
    if (!validateCheckboxGroup(index)) isValid = false;
  });
  
  return isValid;
}

// ============================================================
// COLLECT FORM DATA
// ============================================================
function collectFormData() {
  const data = {
    nombreDependencia: document.getElementById('nombreDependencia').value.trim(),
    correoContacto: document.getElementById('correoContacto').value.trim(),
    responsable: document.getElementById('responsable').value.trim(),
    perfiles: []
  };
  
  const cards = document.querySelectorAll('.perfil-card');
  cards.forEach(card => {
    const index = card.dataset.perfilIndex;
    
    const tipoModalidad = document.querySelector(`input[name="tipoModalidad-${index}"]:checked`);
    const modalidadTrabajo = document.querySelector(`input[name="modalidadTrabajo-${index}"]:checked`);
    const apoyoEstudiante = document.querySelector(`input[name="apoyoEstudiante-${index}"]:checked`);
    const programas = Array.from(document.querySelectorAll(`input[name="programas-${index}"]:checked`)).map(cb => cb.value);
    
    data.perfiles.push({
      tipoModalidad: tipoModalidad ? tipoModalidad.value : '',
      descripcionPerfil: document.getElementById(`descripcionPerfil-${index}`).value.trim(),
      dependenciaProyecto: document.getElementById(`dependenciaProyecto-${index}`).value.trim(),
      cantidadEstudiantes: document.getElementById(`cantidadEstudiantes-${index}`).value.trim(),
      modalidadTrabajo: modalidadTrabajo ? modalidadTrabajo.value : '',
      programas: programas,
      competenciasEspecificas: document.getElementById(`competenciasEspecificas-${index}`).value.trim(),
      habilidadesValoradas: document.getElementById(`habilidadesValoradas-${index}`).value.trim(),
      apoyoEstudiante: apoyoEstudiante ? apoyoEstudiante.value : '',
      observaciones: document.getElementById(`observaciones-${index}`).value.trim()
    });
  });
  
  return data;
}

// ============================================================
// SUBMIT FORM
// ============================================================
function showError(message) {
  const errorAlert = document.getElementById('errorAlert');
  const errorMessage = document.getElementById('errorMessage');
  errorMessage.textContent = message;
  errorAlert.classList.add('visible');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideError() {
  document.getElementById('errorAlert').classList.remove('visible');
}

function showLoading() {
  document.getElementById('loadingOverlay').classList.add('visible');
}

function hideLoading() {
  document.getElementById('loadingOverlay').classList.remove('visible');
}

function showSuccess() {
  document.getElementById('mainForm').style.display = 'none';
  document.getElementById('successMessage').classList.add('visible');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

async function handleSubmit(e) {
  e.preventDefault();
  hideError();
  
  if (!validateForm()) {
    showError('Por favor completa todos los campos obligatorios.');
    return;
  }
  
  const formData = collectFormData();
  
  if (formData.perfiles.length === 0) {
    showError('Debes agregar al menos un perfil.');
    return;
  }
  
  showLoading();
  
  try {
    // Check if google.script.run is available (Apps Script environment)
    if (typeof google !== 'undefined' && google.script && google.script.run) {
      google.script.run
        .withSuccessHandler(function(response) {
          hideLoading();
          if (response.success) {
            showSuccess();
          } else {
            showError(response.error || 'Ocurri√≥ un error al enviar el formulario. Por favor intenta nuevamente.');
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          showError('Error al enviar el formulario: ' + error.message);
        })
        .submitBancoPerfiles(formData);
    } else {
      // Local development mock
      console.log('MOCK SUBMISSION:', formData);
      setTimeout(() => {
        hideLoading();
        showSuccess();
      }, 2000);
    }
  } catch (error) {
    hideLoading();
    showError('Error inesperado: ' + error.message);
  }
}

// ============================================================
// EVENT LISTENERS
// ============================================================
document.getElementById('btnAddPerfil').addEventListener('click', addPerfil);

document.getElementById('btnReset').addEventListener('click', function() {
  if (confirm('¬øEst√°s seguro de que deseas limpiar el formulario?')) {
    document.getElementById('bancoPerfilesForm').reset();
    document.getElementById('perfilesContainer').innerHTML = '';
    perfilCount = 0;
    addPerfil();
    hideError();
  }
});

document.getElementById('bancoPerfilesForm').addEventListener('submit', handleSubmit);

// Add real-time validation
document.querySelectorAll('.form-input, .form-textarea, .form-select').forEach(field => {
  field.addEventListener('blur', function() {
    validateField(this);
  });
});

// ============================================================
// INITIALIZATION
// ============================================================
window.addEventListener('DOMContentLoaded', function() {
  // Add first perfil automatically
  addPerfil();
  
  // Auto-resize iframe
  function adjustHeight() {
    const height = Math.max(
      document.body.scrollHeight,
      document.documentElement.scrollHeight,
      document.body.offsetHeight,
      document.documentElement.offsetHeight
    );
    window.parent.postMessage({ type: 'setHeight', height: height }, '*');
  }
  
  adjustHeight();
  
  // Observe DOM changes
  const observer = new MutationObserver(adjustHeight);
  observer.observe(document.body, { childList: true, subtree: true, attributes: true });
  
  // Adjust on window resize
  window.addEventListener('resize', adjustHeight);
});
</script>

</body>
</html>
